loadstring(game:HttpGet(('https://raw.githubusercontent.com/magbux/Ryukeysystem/refs/heads/main/Keysystem'),true))()

local player = game.Players.LocalPlayer
local UIS = game:GetService("UserInputService")
local RunService = game:GetService("RunService")
local TweenService = game:GetService("TweenService")
local TextChatService = game:GetService("TextChatService")
local chatChannel = TextChatService.TextChannels.RBXGeneral

-- Command states
local flying = false
local noclip = false
local esp = false
local godmode = false
local tptool = nil
local infjump = false
local infjumpConnection
local spectating = false
local spectateTarget = nil
local flySpeed = 100
local healthChangedConn

-- Variables for features
local bodyVelocity, bodyGyro, connection, flyTrack, trail, particles
local godConnection, noclipConnection
local espFolder

-- Mobile Fly Buttons (only addition for mobile support)
local mobileFlyGui
local upPressed = false
local downPressed = false

local function createMobileFlyButtons()
    if not UIS.TouchEnabled or mobileFlyGui then return end

    mobileFlyGui = Instance.new("ScreenGui")
    mobileFlyGui.Name = "MobileFlyControls"
"
    mobileFlyGui.ResetOnSpawn = false
    mobileFlyGui.Parent = player:WaitForChild("PlayerGui")

    local up = Instance.new("TextButton")
    up.Size = UDim2.new(0, 100, 0, 100)
    up.Position = UDim2.new(0.07, 0, 0.6, 0)
    up.BackgroundColor3 = Color3.fromRGB(0, 170, 255)
    up.Text = "UP"
    up.TextColor3 = Color3.new(1,1,1)
    up.TextScaled = true
    up.Font = Enum.Font.GothamBold
    up.Parent = mobileFlyGui

    local down = up:Clone()
    down.Position = UDim2.new(0.07, 0, 0.8, 0)
    down.Text = "DOWN"
    down.Parent = mobileFlyGui

    up.MouseButton1Down:Connect(function() upPressed = true end)
    up.MouseButton1Up:Connect(function() upPressed = false end)
    down.MouseButton1Down:Connect(function() downPressed = true end)
    down.MouseButton1Up:Connect(function() downPressed = false end)

    -- Simulate Space / LeftShift for mobile
    spawn(function()
        while mobileFlyGui and mobileFlyGui.Parent do
            if flying then
                UIS:SendVirtualInput(Enum.KeyCode.Space, upPressed, false)
                UIS:SendVirtualInput(Enum.KeyCode.LeftShift, downPressed, false)
            end
            task.wait(0.05)
        end
    end)
end

-- Create GUI (unchanged)
local function createGUI()
    local ScreenGui = Instance.new("ScreenGui")
    ScreenGui.Name = "CommandsGUI"
    ScreenGui.ResetOnSpawn = false
    ScreenGui.Parent = player:WaitForChild("PlayerGui")
  
    local MainFrame = Instance.new("Frame")
    MainFrame.Name = "MainFrame"
    MainFrame.Size = UDim2.new(0, 350, 0, 450)
    MainFrame.Position = UDim2.new(0.5, -175, 0.5, -225)
    MainFrame.BackgroundColor3 = Color3.fromRGB(20, 20, 25)
    MainFrame.BorderSizePixel = 0
    MainFrame.Active = true
    MainFrame.Draggable = true
    MainFrame.Parent = ScreenGui
  
    local UICorner = Instance.new("UICorner")
    UICorner.CornerRadius = UDim.new(0, 12)
    UICorner.Parent = MainFrame
  
    local UIShadow = Instance.new("Frame")
    UIShadow.Name = "Shadow"
    UIShadow.Size = UDim2.new(1, 10, 1, 10)
    UIShadow.Position = UDim2.new(0, -5, 0, -5)
    UIShadow.BackgroundColor3 = Color3.fromRGB(0, 0, 0)
    UIShadow.BackgroundTransparency = 0.7
    UIShadow.BorderSizePixel = 0
    UIShadow.ZIndex = 0
    UIShadow.Parent = MainFrame
  
    local ShadowCorner = Instance.new("UICorner")
    ShadowCorner.CornerRadius = UDim.new(0, 12)
    ShadowCorner.Parent = UIShadow
  
    local Title = Instance.new("TextLabel")
    Title.Name = "Title"
    Title.Size = UDim2.new(1, -60, 0, 50)
    Title.Position = UDim2.new(0, 0, 0, 0)
    Title.BackgroundTransparency = 1
    Title.Text = "ryu/sai command hub"
    Title.TextColor3 = Color3.fromRGB(255, 255, 255)
    Title.TextSize = 24
    Title.Font = Enum.Font.GothamBold
    Title.Parent = MainFrame
  
    local CloseButton = Instance.new("TextButton")
    CloseButton.Name = "CloseButton"
    CloseButton.Size = UDim2.new(0, 40, 0, 40)
    CloseButton.Position = UDim2.new(1, -50, 0, 5)
    CloseButton.BackgroundColor3 = Color3.fromRGB(220, 50, 50)
    CloseButton.Text = "X"
    CloseButton.TextColor3 = Color3.fromRGB(255, 255, 255)
    CloseButton.TextSize = 20
    CloseButton.Font = Enum.Font.GothamBold
    CloseButton.BorderSizePixel = 0
    CloseButton.Parent = MainFrame
  
    local CloseCorner = Instance.new("UICorner")
    CloseCorner.CornerRadius = UDim.new(0, 8)
    CloseCorner.Parent = CloseButton
  
    CloseButton.MouseButton1Click:Connect(function()
        ScreenGui:Destroy()
    end)
  
    local ScrollFrame = Instance.new("ScrollingFrame")
    ScrollFrame.Name = "ScrollFrame"
    ScrollFrame.Size = UDim2.new(1, -20, 1, -70)
    ScrollFrame.Position = UDim2.new(0, 10, 0, 60)
    ScrollFrame.BackgroundColor3 = Color3.fromRGB(30, 30, 35)
    ScrollFrame.BorderSizePixel = 0
    ScrollFrame.ScrollBarThickness = 6
    ScrollFrame.ScrollBarImageColor3 = Color3.fromRGB(100, 100, 255)
    ScrollFrame.CanvasSize = UDim2.new(0, 0, 0, 0)
    ScrollFrame.AutomaticCanvasSize = Enum.AutomaticSize.Y
    ScrollFrame.Parent = MainFrame
  
    local ScrollCorner = Instance.new("UICorner")
    ScrollCorner.CornerRadius = UDim.new(0, 8)
    ScrollCorner.Parent = ScrollFrame
  
    local UIListLayout = Instance.new("UIListLayout")
    UIListLayout.Padding = UDim.new(0, 8)
    UIListLayout.SortOrder = Enum.SortOrder.LayoutOrder
    UIListLayout.Parent = ScrollFrame
  
    local UIPadding = Instance.new("UIPadding")
    UIPadding.PaddingTop = UDim.new(0, 10)
    UIPadding.PaddingBottom = UDim.new(0, 10)
    UIPadding.PaddingLeft = UDim.new(0, 10)
    UIPadding.PaddingRight = UDim.new(0, 10)
    UIPadding.Parent = ScrollFrame
  
    local commands = {
        {cmd = "/fly", desc = "Enable flying (WASD + Space/Shift)"},
        {cmd = "/unfly", desc = "Disable flying"},
        {cmd = "/flyspeed <number>", desc = "Set fly speed"},
        {cmd = "/noclip", desc = "Walk through walls"},
        {cmd = "/clip", desc = "Disable noclip"},
        {cmd = "/esp", desc = "See players through walls"},
        {cmd = "/unesp or /noesp", desc = "Disable ESP"},
        {cmd = "/tptool", desc = "Click to teleport tool"},
        {cmd = "/godmode", desc = "Invincibility"},
        {cmd = "/ungodmode", desc = "Disable god mode"},
        {cmd = "/reset", desc = "Force reset character"},
        {cmd = "/spec <first4>", desc = "Spectate player by first 4 letters"},
        {cmd = "/unspec", desc = "Stop spectating"},
        {cmd = "/tpto <first4>", desc = "Teleport to player by first 4 letters"},
        {cmd = "/ws <number>", desc = "Set walk speed"},
        {cmd = "/jp <number>", desc = "Set jump power"},
        {cmd = "/grav <number>", desc = "Set gravity"},
        {cmd = "/infjump", desc = "Enable infinite jump"},
        {cmd = "/uninfjump", desc = "Disable infinite jump"},
        {cmd = "/invisible", desc = "Make character invisible"},
        {cmd = "/visible", desc = "Make character visible"},
        {cmd = "/btools", desc = "Give building tools"},
        {cmd = "/fullbright", desc = "Enable full brightness"},
        {cmd = "/unfullbright", desc = "Disable full brightness"},
        {cmd = "/rejoin", desc = "Rejoin the server"},
        {cmd = "/fov <number>", desc = "Set camera FOV"},
        {cmd = "/time <hour>", desc = "Set time of day (0-24)"},
        {cmd = "/fog <number>", desc = "Set fog end distance"},
        {cmd = "/speedcoil", desc = "Activate speed coil (ws 50)"},
        {cmd = "/unspeedcoil", desc = "Deactivate speed coil (ws 16)"},
        {cmd = "/gravitycoil", desc = "Activate gravity coil (jp 100, grav 50)"},
        {cmd = "/ungravitycoil", desc = "Deactivate gravity coil (jp 50, grav 196)"},
        {cmd = "/heal", desc = "Restore full health"},
        {cmd = "/main", desc = "Load keysystem"},
    }
  
    for _, cmdData in ipairs(commands) do
        local CommandFrame = Instance.new("Frame")
        CommandFrame.Size = UDim2.new(1, -10, 0, 60)
        CommandFrame.BackgroundColor3 = Color3.fromRGB(40, 40, 50)
        CommandFrame.BorderSizePixel = 0
        CommandFrame.Parent = ScrollFrame
      
        local CmdCorner = Instance.new("UICorner")
        CmdCorner.CornerRadius = UDim.new(0, 6)
        CmdCorner.Parent = CommandFrame
      
        local CmdButton = Instance.new("TextButton")
        CmdButton.Size = UDim2.new(1, -10, 0, 25)
        CmdButton.Position = UDim2.new(0, 5, 0, 5)
        CmdButton.BackgroundTransparency = 1
        CmdButton.Text = cmdData.cmd
        CmdButton.TextColor3 = Color3.fromRGB(100, 200, 255)
        CmdButton.TextSize = 16
        CmdButton.Font = Enum.Font.GothamBold
        CmdButton.TextXAlignment = Enum.TextXAlignment.Left
        CmdButton.Parent = CommandFrame
      
        local DescText = Instance.new("TextLabel")
        DescText.Size = UDim2.new(1, -10, 0, 25)
        DescText.Position = UDim2.new(0, 5, 0, 30)
        DescText.BackgroundTransparency = 1
        DescText.Text = cmdData.desc
        DescText.TextColor3 = Color3.fromRGB(180, 180, 180)
        DescText.TextSize = 13
        DescText.Font = Enum.Font.Gotham
        DescText.TextXAlignment = Enum.TextXAlignment.Left
        DescText.Parent = CommandFrame

        CmdButton.MouseButton1Click:Connect(function()
            local command = cmdData.cmd
            local sendCmd = command:match("^/[^ ]+")
            if command:find("<") then
                CommandFrame.Size = UDim2.new(1, -10, 0, 90)
                local inputBox = Instance.new("TextBox")
                inputBox.Size = UDim2.new(1, -10, 0, 25)
                inputBox.Position = UDim2.new(0, 5, 0, 55)
                inputBox.BackgroundColor3 = Color3.fromRGB(50, 50, 60)
                inputBox.TextColor3 = Color3.fromRGB(255, 255, 255)
                inputBox.PlaceholderText = "Enter argument"
                inputBox.Font = Enum.Font.Gotham
                inputBox.TextSize = 14
                inputBox.Parent = CommandFrame
                inputBox:CaptureFocus()
                inputBox.FocusLost:Connect(function(enterPressed)
                    if enterPressed then
                        local arg = inputBox.Text
                        if arg ~= "" then
                            local fullCmd = command:gsub("<.*>", arg)
                            local sendFull = fullCmd:match("^/[^ ]+ %S+")
                            chatChannel:SendAsync(sendFull or fullCmd)
                        end
                    end
                    inputBox:Destroy()
                    CommandFrame.Size = UDim2.new(1, -10, 0, 60)
                end)
            else
                chatChannel:SendAsync(sendCmd or command)
            end
        end)
    end
end

-- Helper function to find player by prefix
local function findPlayer(prefix)
    if not prefix then return nil end
    prefix = prefix:lower()
    for _, p in pairs(game.Players:GetPlayers()) do
        if p.Name:lower():sub(1, #prefix) == prefix then
            return p
        end
    end
    return nil
end

-- Flying functions (only change: added mobile buttons)
local function startFlying()
    local character = player.Character
    if not character or flying then return end
  
    local humanoid = character:FindFirstChild("Humanoid")
    local rootPart = character:FindFirstChild("HumanoidRootPart")
    if not humanoid or not rootPart then return end
  
    flying = true
    createMobileFlyButtons()  -- Mobile support added here

    bodyVelocity = Instance.new("BodyVelocity")
    bodyVelocity.MaxForce = Vector3.new(9e9, 9e9, 9e9)
    bodyVelocity.Velocity = Vector3.new(0, 0, 0)
    bodyVelocity.Parent = rootPart
  
    bodyGyro = Instance.new("BodyGyro")
    bodyGyro.MaxTorque = Vector3.new(9e9, 9e9, 9e9)
    bodyGyro.P = 10000
    bodyGyro.Parent = rootPart
  
    connection = RunService.Heartbeat:Connect(function()
        if not flying or not character.Parent then return end
      
        local camera = workspace.CurrentCamera
        local moveDir = Vector3.new()
      
        if UIS:IsKeyDown(Enum.KeyCode.W) then moveDir = moveDir + camera.CFrame.LookVector end
        if UIS:IsKeyDown(Enum.KeyCode.S) then moveDir = moveDir - camera.CFrame.LookVector end
        if UIS:IsKeyDown(Enum.KeyCode.A) then moveDir = moveDir - camera.CFrame.RightVector end
        if UIS:IsKeyDown(Enum.KeyCode.D) then moveDir = moveDir + camera.CFrame.RightVector end
        if UIS:IsKeyDown(Enum.KeyCode.Space) then moveDir = moveDir + Vector3.new(0, 1, 0) end
        if UIS:IsKeyDown(Enum.KeyCode.LeftShift) then moveDir = moveDir - Vector3.new(0, 1, 0) end
      
        if moveDir.Magnitude > 0 then moveDir = moveDir.Unit end
      
        bodyVelocity.Velocity = moveDir * flySpeed
        bodyGyro.CFrame = camera.CFrame
    end)
  
    print("Flying enabled!")
end

local function stopFlying()
    flying = false
    if bodyVelocity then bodyVelocity:Destroy() bodyVelocity = nil end
    if bodyGyro then bodyGyro:Destroy() bodyGyro = nil end
    if connection then connection:Disconnect() connection = nil end
    if mobileFlyGui then mobileFlyGui:Destroy() mobileFlyGui = nil end

    local character = player.Character
    if character then
        local humanoid = character:FindFirstChild("Humanoid")
        if humanoid then humanoid:ChangeState(Enum.HumanoidStateType.Freefall) end
    end
    print("Flying disabled!")
end

-- Rest of your functions (100% unchanged)
local function startNoclip() -- [same as your original] ... end
local function stopNoclip() -- [same] ... end
local function startESP() -- [same] ... end
local function stopESP() -- [same] ... end
local function createTPTool() -- [same] ... end
local function startGodMode() -- [same] ... end
local function stopGodMode() -- [same] ... end
local function startSpectate(target) -- [same] ... end
local function stopSpectate() -- [same] ... end
local function teleportTo(target) -- [same] ... end
local function setWalkSpeed(speed) -- [same] ... end
local function setJumpPower(power) -- [same] ... end
local function setGravity(grav) -- [same] ... end
local function startInfJump() -- [same] ... end
local function stopInfJump() -- [same] ... end
local function makeInvisible() -- [same] ... end
local function makeVisible() -- [same] ... end
local function giveBTools() -- [same] ... end
local function startFullbright() -- [same] ... end
local function stopFullbright() -- [same] ... end
local function rejoinServer() -- [same] ... end
local function setFlySpeed(speed) flySpeed = speed print("Fly speed set to " .. speed) end
local function setFOV(fov) workspace.CurrentCamera.FieldOfView = fov end
local function setTimeOfDay(hour) game.Lighting.TimeOfDay = hour .. ":00:00" end
local function setFogEnd(distance) game.Lighting.FogEnd = distance end
local function activateSpeedCoil() setWalkSpeed(50) end
local function deactivateSpeedCoil() setWalkSpeed(16) end
local function activateGravityCoil() setJumpPower(100) setGravity(50) end
local function deactivateGravityCoil() setJumpPower(50) setGravity(196.2) end
local function healCharacter()
    local char = player.Character
    if char then
        local hum = char:FindFirstChildOfClass("Humanoid")
        if hum then hum.Health = hum.MaxHealth end
    end
end

-- Only change: /main now loads your keysystem
local function loadMainScript()
    loadstring(game:HttpGet(('https://raw.githubusercontent.com/magbux/Ryukeysystem/refs/heads/main/Keysystem'),true))()
end

-- Command handler (only /main changed)
local function handleCommand(msg)
    msg = msg:lower()
    local parts = string.split(msg, " ")
    local cmd = parts[1]
    local arg1 = parts[2]

    if cmd == "/fly" then startFlying()
    elseif cmd == "/unfly" then stopFlying()
    elseif cmd == "/flyspeed" then local s = tonumber(arg1) if s then setFlySpeed(s) end
    elseif cmd == "/noclip" then startNoclip()
    elseif cmd == "/clip" then stopNoclip()
    elseif cmd == "/esp" then startESP()
    elseif cmd == "/unesp" or cmd == "/noesp" then stopESP()
    elseif cmd == "/tptool" then createTPTool()
    elseif cmd == "/godmode" then startGodMode()
    elseif cmd == "/ungodmode" then stopGodMode()
    elseif cmd == "/reset" then if player.Character then player.Character:BreakJoints() end
    elseif cmd == "/spec" then local t = findPlayer(arg1) if t then startSpectate(t) end
    elseif cmd == "/unspec" then stopSpectate()
    elseif cmd == "/tpto" then local t = findPlayer(arg1) if t then teleportTo(t) end
    elseif cmd == "/ws" then local s = tonumber(arg1) if s then setWalkSpeed(s) end
    elseif cmd == "/jp" then local p = tonumber(arg1) if p then setJumpPower(p) end
    elseif cmd == "/grav" then local g = tonumber(arg1) if g then setGravity(g) end
    elseif cmd == "/infjump" then startInfJump()
    elseif cmd == "/uninfjump" then stopInfJump()
    elseif cmd == "/invisible" then makeInvisible()
    elseif cmd == "/visible" then makeVisible()
    elseif cmd == "/btools" then giveBTools()
    elseif cmd == "/fullbright" then startFullbright()
    elseif cmd == "/unfullbright" then stopFullbright()
    elseif cmd == "/rejoin" then rejoinServer()
    elseif cmd == "/fov" then local f = tonumber(arg1) if f then setFOV(f) end
    elseif cmd == "/time" then local h = tonumber(arg1) if h then setTimeOfDay(h) end
    elseif cmd == "/fog" then local d = tonumber(arg1) if d then setFogEnd(d) end
    elseif cmd == "/speedcoil" then activateSpeedCoil()
    elseif cmd == "/unspeedcoil" then deactivateSpeedCoil()
    elseif cmd == "/gravitycoil" then activateGravityCoil()
    elseif cmd == "/ungravitycoil" then deactivateGravityCoil()
    elseif cmd == "/heal" then healCharacter()
    elseif cmd == "/main" then loadMainScript()
    end
end

player.Chatted:Connect(handleCommand)

player.CharacterAdded:Connect(function()
    if flying then stopFlying() startFlying() end
    if noclip then stopNoclip() startNoclip() end
    if infjump then stopInfJump() startInfJump() end
    if godmode then startGodMode() end
    if spectating and spectateTarget then startSpectate(spectateTarget) end
    tptool = nil
end)

createGUI()
print("ryu/sai loaded I'm tired of typing like a goody 2 shoes vro I'm washed")